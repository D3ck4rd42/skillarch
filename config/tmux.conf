# ╭─────────────────────────────────────────────────────────╮
# │                    TMUX CONFIGURATION                   │
# │                 Organized and optimized                 │
# ╰─────────────────────────────────────────────────────────╯

# ═══════════════════════════════════════════════════════════
# 1. CORE SETTINGS
# ═══════════════════════════════════════════════════════════

# Prefix key configuration
set -g prefix ^A
unbind C-b

# Terminal settings
set-option -g default-terminal 'screen-256color'
set-option -g terminal-overrides ',xterm-256color:RGB'

# General options
set -g base-index 1              # start indexing windows at 1 instead of 0
set -g detach-on-destroy off     # don't exit from tmux when closing a session
set -g escape-time 0             # zero-out escape time delay
set -g history-limit 1000000     # increase history size (from 2,000)
set -g renumber-windows on       # renumber all windows when any window is closed
set -g set-clipboard on          # use system clipboard
set -g status-position top       # macOS / darwin style
set -g default-shell /bin/zsh
set -g default-command "/bin/zsh"
set-option -ga update-environment ' ZDOTDIR'
#setw -g mode-keys vi             # use vi key bindings in copy mode

# ═══════════════════════════════════════════════════════════
# 2. KEY BINDINGS
# ═══════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────
# Window Management
# ─────────────────────────────────────────────────────────
bind ^w new-window -c "$HOME"    # new window in home directory
bind ^C list-windows             # list all windows
bind W list-windows              # list all windows (alias)
bind r command-prompt "rename-window %%"  # rename current window
bind '"' choose-window           # choose window from list

# Function Keys Navigation (F1-F8 for windows 1-8)
bind-key -n F1 select-window -t 1
bind-key -n F2 select-window -t 2
bind-key -n F3 select-window -t 3
bind-key -n F4 select-window -t 4
bind-key -n F5 select-window -t 5
bind-key -n F6 select-window -t 6
bind-key -n F7 select-window -t 7
bind-key -n F8 select-window -t 8

# ─────────────────────────────────────────────────────────
# Pane Management
# ─────────────────────────────────────────────────────────
# Splitting
bind v split-window -h -c "#{pane_current_path}" # split horizontal (keep path)
bind s split-window -v -c "#{pane_current_path}" # split vertical (keep path)
bind "'" split-window -h \; split-window -v \; select-pane -t 0 \; split-window -v \; select-pane -t 2  # 4-pane split



# Resizing (repeatable with -r flag)
bind -r -T prefix , resize-pane -L 20
bind -r -T prefix . resize-pane -R 20
bind -r -T prefix - resize-pane -D 7
bind -r -T prefix = resize-pane -U 7

# Pane control

bind q kill-pane                 # kill current pane

# ─────────────────────────────────────────────────────────
# Session Management
# ─────────────────────────────────────────────────────────
bind ^D detach                   # detach from session
bind S choose-session            # choose session from list
bind ^X lock-server              # lock tmux server
bind X kill-session              # kill current session

# ─────────────────────────────────────────────────────────
# Copy Mode
# ─────────────────────────────────────────────────────────
#bind-key -T copy-mode-vi v send-keys -X begin-selection

# ─────────────────────────────────────────────────────────
# Buffer Management
# ─────────────────────────────────────────────────────────
bind-key z choose-buffer -F "#{buffer_sample}" "paste-buffer -b '%%'"  # show buffers with preview
bind-key B run-shell "tmux list-buffers | sed -n 's/:.*//p' | xargs -I{} tmux delete-buffer -b {}" \; display-message "All buffers cleared"
bind-key C-s command-prompt -p "Save to buffer:" "run 'tmux save-buffer -b %%'"
bind-key o run-shell "/bin/zsh /opt/my-resources/setup/tmux/session-manager.sh \; display-message "All buffers cleared""
# ─────────────────────────────────────────────────────────
# Utility Bindings
# ─────────────────────────────────────────────────────────
bind R source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"
bind ^L refresh-client           # refresh tmux client
bind : command-prompt            # enter command mode
bind * setw synchronize-panes    # synchronize all panes
bind K send-keys "clear"\; send-keys "Enter"  # clear terminal

# Help bindings
bind-key ? display-popup -E -w 80% -h 80% "cat ~/.config/tmux/QUICK_REFERENCE.md"
bind-key H display-popup -E -w 90% -h 90% "less ~/.config/tmux/TMUX_CHEATSHEET.md"


# F10 pour voir toutes les sessions
bind -n F10 choose-tree -Zs

# F11 pour session précédente
bind -n F11 switch-client -l

# F12 pour tuer la session courante
bind -n F12 confirm-before -p "Kill session #S? (y/n)" kill-session


# ═══════════════════════════════════════════════════════════
# 3. VISUAL SETTINGS
# ═══════════════════════════════════════════════════════════

# Pane borders
set -g pane-border-style 'fg=brightblack,bg=default'
set -g pane-active-border-style 'fg=magenta,bg=default'

# Custom colors to match Catppuccin theme
set -g status-bg "#1a1825"
set -g pane-border-style 'fg=#313244,bg=#1a1825'
set -g pane-active-border-style 'fg=#cba6f7,bg=#1a1825'
set -g message-style "fg=#cdd6f4,bg=#1a1825"
set -g message-command-style "fg=#cdd6f4,bg=#1a1825"

# Window background
set -g window-style 'bg=#1a1825'
set -g window-active-style 'bg=#1a1825'

# Status bar
set -g status-style "bg=#1a1825,fg=#cdd6f4"
set -g status-left-length 150
set -g status-right-length 150

# ═══════════════════════════════════════════════════════════
# 4. MOUSE & CLIPBOARD
# ═══════════════════════════════════════════════════════════

# Enable mouse support
set -g mouse on

# Configure tmux-yank for mouse support
set -g @yank_with_mouse on
set -g @yank_selection_mouse 'clipboard'

# Override copy command to use xsel on X11
set -g @override_copy_command 'xsel -i -b'


# Mouse events are already handled by 'set -g mouse on' above


# For vi mode users
#set -g @shell_mode 'vi'

# ═══════════════════════════════════════════════════════════
# 5. PLUGINS
# ═══════════════════════════════════════════════════════════

# Plugin Manager Path
set-environment -g TMUX_PLUGIN_MANAGER_PATH "$HOME/.config/tmux/plugins/"

# Plugin list
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'laktak/extrakto'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'


# ─────────────────────────────────────────────────────────
# Plugin Configurations
# ─────────────────────────────────────────────────────────

# Extrakto - text extraction
set -g @extrakto_key 'tab'
set -g @extrakto_default_opt 'lines'
set -g @extrakto_split_direction 'v'
set -g @extrakto_split_size '15'
set -g @extrakto_grab_area 'window full'
set -g @extrakto_clip_tool 'xsel -i -b'



# Continuum & Resurrect - session persistence
set -g @continuum-restore 'off'
set -g @resurrect-strategy-nvim 'session'
# --- Configuration Continuum & Resurrect ---
set -g @resurrect-save 'on'
set -g @continuum-save-interval '0'


# ═══════════════════════════════════════════════════════════
# 7. INITIALIZE TMUX PLUGIN MANAGER
# ═══════════════════════════════════════════════════════════
# Keep this line at the very bottom of tmux.conf
run '~/.config/tmux/plugins/tpm/tpm'